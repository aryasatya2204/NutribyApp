<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\GrowthStandard;
use Illuminate\Support\Facades\DB;

class GrowthStandardSeeder extends Seeder
{
    public function run()
    {
        DB::table('growth_standards')->delete();

        $standards = $this->getWHOStandards();
        $dataToInsert = [];

        foreach ($standards as $genderKey => $metrics) {
            $gender = ($genderKey === 'boys') ? 'male' : 'female';

            foreach ($metrics as $metricKey => $dataPoints) {
                foreach ($dataPoints as $reference => $params) {
                    $L = $params[0];
                    $M = $params[1];
                    $S = $params[2];

                    if ($L == 0) continue;

                    $record = [
                        'gender'                => $gender,
                        'age_in_months'         => null, // Default to null
                        'reference_height_cm'   => null, // Default to null
                        'metric'                => null, // Akan diisi di bawah
                        'median'                => $M,
                        'sd3_neg'               => $M * pow(1 + $L * $S * (-3), 1 / $L),
                        'sd2_neg'               => $M * pow(1 + $L * $S * (-2), 1 / $L),
                        'sd1_neg'               => $M * pow(1 + $L * $S * (-1), 1 / $L),
                        'sd1_pos'               => $M * pow(1 + $L * $S * (1), 1 / $L),
                        'sd2_pos'               => $M * pow(1 + $L * $S * (2), 1 / $L),
                        'sd3_pos'               => $M * pow(1 + $L * $S * (3), 1 / $L),
                    ];

                    // Sekarang, isi nilai yang spesifik untuk metrik ini
                    if ($metricKey === 'weight_for_age') {
                        $record['metric'] = 'wfa';
                        $record['age_in_months'] = $reference;
                    } elseif ($metricKey === 'height_for_age') {
                        $record['metric'] = 'hfa';
                        $record['age_in_months'] = $reference;
                    } elseif ($metricKey === 'weight_for_height') {
                        $record['metric'] = 'wfh';
                        $record['reference_height_cm'] = $reference;
                    }

                    // Hanya tambahkan ke array jika metriknya valid
                    if ($record['metric']) {
                        $dataToInsert[] = $record;
                    }
                }
            }
        }

        // Karena datanya banyak, kita pecah proses insert menjadi beberapa bagian (chunk)
        // Ini mencegah error "max placeholders" di beberapa konfigurasi server
        foreach (array_chunk($dataToInsert, 50) as $chunk) {
            GrowthStandard::insert($chunk);
        }
    }

    /**
     * Provides the raw WHO LMS parameters.
     * @return array
     */
    private function getWHOStandards(): array
    {
        // Data lengkap 
        return [
            'boys' => [
                'weight_for_age' => [
                    6 => [0.2581, 7.934, 0.12551], 7 => [0.2548, 8.297, 0.12604], 8 => [0.2515, 8.623, 0.12664], 9 => [0.2486, 8.918, 0.12730], 10 => [0.2458, 9.188, 0.12802], 11 => [0.2432, 9.438, 0.12879], 12 => [0.2408, 9.670, 0.12961], 13 => [0.2384, 9.888, 0.13048], 14 => [0.2362, 10.093, 0.13140], 15 => [0.2341, 10.287, 0.13237], 16 => [0.2322, 10.472, 0.13338], 17 => [0.2303, 10.649, 0.13444], 18 => [0.2285, 10.818, 0.13555], 19 => [0.2268, 10.981, 0.13670], 20 => [0.2252, 11.138, 0.13790], 21 => [0.2236, 11.290, 0.13914], 22 => [0.2221, 11.437, 0.14042], 23 => [0.2207, 11.580, 0.14175], 24 => [0.2194, 11.719, 0.14312]
                ],
                'height_for_age' => [
                    6 => [1.0430, 67.62, 0.04287], 7 => [1.0500, 69.16, 0.04138], 8 => [1.0553, 70.60, 0.04000], 9 => [1.0592, 71.97, 0.03873], 10 => [1.0618, 73.28, 0.03756], 11 => [1.0634, 74.53, 0.03649], 12 => [1.0640, 75.75, 0.03551], 13 => [1.0638, 76.93, 0.03460], 14 => [1.0628, 78.07, 0.03376], 15 => [1.0612, 79.18, 0.03298], 16 => [1.0590, 80.25, 0.03226], 17 => [1.0563, 81.30, 0.03159], 18 => [1.0532, 82.32, 0.03097], 19 => [1.0497, 83.31, 0.03039], 20 => [1.0460, 84.28, 0.02985], 21 => [1.0420, 85.23, 0.02935], 22 => [1.0378, 86.16, 0.02888], 23 => [1.0335, 87.07, 0.02844], 24 => [1.0291, 87.96, 0.02804]
                ],
                'weight_for_height' => [
                    65.0 => [-1.5521, 7.270, 0.08962], 65.5 => [-1.5390, 7.348, 0.08973], 66.0 => [-1.5261, 7.426, 0.08984], 66.5 => [-1.5133, 7.504, 0.08995], 67.0 => [-1.5008, 7.583, 0.09006], 67.5 => [-1.4884, 7.663, 0.09017], 68.0 => [-1.4762, 7.743, 0.09028], 68.5 => [-1.4641, 7.824, 0.09039], 69.0 => [-1.4522, 7.905, 0.09050], 69.5 => [-1.4404, 7.986, 0.09060], 70.0 => [-1.4288, 8.068, 0.09071], 70.5 => [-1.4173, 8.150, 0.09081], 71.0 => [-1.4060, 8.232, 0.09091], 71.5 => [-1.3948, 8.315, 0.09101], 72.0 => [-1.3837, 8.398, 0.09111], 72.5 => [-1.3728, 8.481, 0.09121], 73.0 => [-1.3620, 8.565, 0.09131], 73.5 => [-1.3513, 8.649, 0.09141], 74.0 => [-1.3408, 8.733, 0.09151], 74.5 => [-1.3303, 8.818, 0.09160], 75.0 => [-1.3200, 8.902, 0.09170], 75.5 => [-1.3098, 8.987, 0.09179], 76.0 => [-1.2997, 9.073, 0.09189], 76.5 => [-1.2897, 9.158, 0.09198], 77.0 => [-1.2798, 9.244, 0.09207], 77.5 => [-1.2700, 9.330, 0.09216], 78.0 => [-1.2603, 9.416, 0.09225], 78.5 => [-1.2507, 9.502, 0.09234], 79.0 => [-1.2412, 9.589, 0.09243], 79.5 => [-1.2318, 9.676, 0.09252], 80.0 => [-1.2224, 9.763, 0.09261], 80.5 => [-1.2132, 9.850, 0.09270], 81.0 => [-1.2040, 9.938, 0.09279], 81.5 => [-1.1949, 10.026, 0.09288], 82.0 => [-1.1859, 10.114, 0.09297], 82.5 => [-1.1770, 10.203, 0.09306], 83.0 => [-1.1681, 10.291, 0.09315], 83.5 => [-1.1593, 10.380, 0.09324], 84.0 => [-1.1506, 10.469, 0.09333], 84.5 => [-1.1419, 10.558, 0.09342], 85.0 => [-0.8176, 11.724, 0.09139], 85.5 => [-0.8087, 11.839, 0.09153], 86.0 => [-0.7998, 11.955, 0.09167], 86.5 => [-0.7910, 12.072, 0.09180], 87.0 => [-0.7822, 12.190, 0.09194], 87.5 => [-0.7735, 12.308, 0.09208], 88.0 => [-0.7649, 12.427, 0.09222], 88.5 => [-0.7563, 12.547, 0.09236], 89.0 => [-0.7478, 12.667, 0.09250], 89.5 => [-0.7394, 12.787, 0.09264], 90.0 => [-0.7310, 12.908, 0.09278], 90.5 => [-0.7228, 13.030, 0.09292], 91.0 => [-0.7146, 13.152, 0.09306], 91.5 => [-0.7065, 13.274, 0.09320], 92.0 => [-0.6985, 13.397, 0.09334], 92.5 => [-0.6905, 13.520, 0.09348], 93.0 => [-0.6826, 13.644, 0.09362], 93.5 => [-0.6748, 13.768, 0.09376], 94.0 => [-0.6671, 13.892, 0.09390], 94.5 => [-0.6594, 14.017, 0.09404], 95.0 => [-0.6518, 14.142, 0.09418]
                ]
            ],
            'girls' => [
                 'weight_for_age' => [
                    6 => [0.2614, 7.297, 0.12619], 7 => [0.2594, 7.635, 0.12665], 8 => [0.2576, 7.953, 0.12717], 9 => [0.2558, 8.254, 0.12774], 10 => [0.2542, 8.540, 0.12837], 11 => [0.2526, 8.814, 0.12905], 12 => [0.2511, 9.077, 0.12979], 13 => [0.2497, 9.331, 0.13058], 14 => [0.2484, 9.576, 0.13142], 15 => [0.2471, 9.814, 0.13231], 16 => [0.2459, 10.046, 0.13325], 17 => [0.2447, 10.271, 0.13424], 18 => [0.2436, 10.491, 0.13528], 19 => [0.2425, 10.706, 0.13637], 20 => [0.2415, 10.916, 0.13751], 21 => [0.2405, 11.123, 0.13869], 22 => [0.2395, 11.326, 0.13993], 23 => [0.2386, 11.527, 0.14121], 24 => [0.2378, 11.725, 0.14254]
                ],
                'height_for_age' => [
                    6 => [1.0364, 65.73, 0.04237], 7 => [1.0440, 67.28, 0.04105], 8 => [1.0500, 68.75, 0.03980], 9 => [1.0546, 70.14, 0.03863], 10 => [1.0579, 71.47, 0.03753], 11 => [1.0601, 72.75, 0.03651], 12 => [1.0613, 73.98, 0.03557], 13 => [1.0617, 75.17, 0.03470], 14 => [1.0613, 76.31, 0.03390], 15 => [1.0603, 77.42, 0.03316], 16 => [1.0587, 78.49, 0.03248], 17 => [1.0566, 79.53, 0.03186], 18 => [1.0541, 80.54, 0.03128], 19 => [1.0512, 81.53, 0.03075], 20 => [1.0481, 82.49, 0.03026], 21 => [1.0447, 83.42, 0.02981], 22 => [1.0411, 84.34, 0.02940], 23 => [1.0374, 85.23, 0.02902], 24 => [1.0336, 86.11, 0.02867]
                ],
                'weight_for_height' => [
                    65.0 => [-1.4779, 7.047, 0.08901], 65.5 => [-1.4655, 7.122, 0.08911], 66.0 => [-1.4533, 7.197, 0.08921], 66.5 => [-1.4413, 7.273, 0.08931], 67.0 => [-1.4294, 7.349, 0.08941], 67.5 => [-1.4177, 7.426, 0.08951], 68.0 => [-1.4061, 7.503, 0.08961], 68.5 => [-1.3947, 7.581, 0.08971], 69.0 => [-1.3835, 7.659, 0.08981], 69.5 => [-1.3725, 7.737, 0.08991], 70.0 => [-1.3616, 7.816, 0.09001], 70.5 => [-1.3508, 7.894, 0.09010], 71.0 => [-1.3402, 7.973, 0.09020], 71.5 => [-1.3297, 8.052, 0.09030], 72.0 => [-1.3194, 8.131, 0.09039], 72.5 => [-1.3092, 8.210, 0.09049], 73.0 => [-1.2991, 8.290, 0.09058], 73.5 => [-1.2891, 8.369, 0.09067], 74.0 => [-1.2793, 8.449, 0.09077], 74.5 => [-1.2696, 8.529, 0.09086], 75.0 => [-1.2600, 8.609, 0.09095], 75.5 => [-1.2505, 8.689, 0.09104], 76.0 => [-1.2411, 8.770, 0.09113], 76.5 => [-1.2318, 8.850, 0.09122], 77.0 => [-1.2227, 8.931, 0.09131], 77.5 => [-1.2136, 9.012, 0.09140], 78.0 => [-1.2046, 9.093, 0.09149], 78.5 => [-1.1958, 9.174, 0.09158], 79.0 => [-1.1870, 9.256, 0.09167], 79.5 => [-1.1783, 9.337, 0.09176], 80.0 => [-1.1697, 9.419, 0.09185], 80.5 => [-1.1612, 9.501, 0.09194], 81.0 => [-1.1528, 9.583, 0.09203], 81.5 => [-1.1444, 9.665, 0.09212], 82.0 => [-1.1362, 9.747, 0.09221], 82.5 => [-1.1279, 9.830, 0.09230], 83.0 => [-1.1198, 9.913, 0.09239], 83.5 => [-1.1117, 9.996, 0.09248], 84.0 => [-1.1037, 10.079, 0.09257], 84.5 => [-1.0958, 10.163, 0.09266], 85.0 => [-0.7859, 11.308, 0.09071], 85.5 => [-0.7777, 11.416, 0.09084], 86.0 => [-0.7696, 11.525, 0.09097], 86.5 => [-0.7616, 11.635, 0.09110], 87.0 => [-0.7537, 11.745, 0.09123], 87.5 => [-0.7459, 11.856, 0.09136], 88.0 => [-0.7382, 11.967, 0.09149], 88.5 => [-0.7305, 12.079, 0.09162], 89.0 => [-0.7230, 12.191, 0.09175], 89.5 => [-0.7155, 12.304, 0.09188], 90.0 => [-0.7081, 12.417, 0.09201], 90.5 => [-0.7008, 12.531, 0.09214], 91.0 => [-0.6936, 12.645, 0.09227], 91.5 => [-0.6865, 12.760, 0.09240], 92.0 => [-0.6795, 12.875, 0.09253], 92.5 => [-0.6725, 12.990, 0.09266], 93.0 => [-0.6656, 13.106, 0.09279], 93.5 => [-0.6588, 13.222, 0.09292], 94.0 => [-0.6521, 13.339, 0.09305], 94.5 => [-0.6454, 13.456, 0.09318], 95.0 => [-0.6388, 13.573, 0.09331]
                ]
            ]
        ];
    }
}